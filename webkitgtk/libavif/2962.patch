From f339b135ce4a3999b9bd66a77db6160c9f23dabf Mon Sep 17 00:00:00 2001
From: Wan-Teh Chang <wtc@google.com>
Date: Mon, 12 Jan 2026 16:12:42 -0800
Subject: [PATCH] Set SVT-AV1's avif option for v4.0.0 or later

---
 src/codec_svt.c | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/src/codec_svt.c b/src/codec_svt.c
index e81b30cf3c..4963bf9691 100644
--- a/src/codec_svt.c
+++ b/src/codec_svt.c
@@ -245,8 +245,12 @@ static avifResult svtCodecEncodeImage(avifCodec * codec,
 
 #if SVT_AV1_CHECK_VERSION(3, 0, 0)
         svt_config->lossless = quality == AVIF_QUALITY_LOSSLESS;
-        // TODO: https://gitlab.com/AOMediaCodec/SVT-AV1/-/issues/2245 - Enable when resolved.
-        // svt_config->avif = (addImageFlags & AVIF_ADD_IMAGE_FLAG_SINGLE) != 0;
+#endif
+
+#if SVT_AV1_CHECK_VERSION(4, 0, 0)
+        // Although the `avif` option was added in v3.0.0, it had a serious bug that was not fixed
+        // until v4.0.0. See https://gitlab.com/AOMediaCodec/SVT-AV1/-/issues/2245.
+        svt_config->avif = (addImageFlags & AVIF_ADD_IMAGE_FLAG_SINGLE) != 0;
 #endif
 
         res = svt_av1_enc_set_parameter(codec->internal->svt_encoder, svt_config);
